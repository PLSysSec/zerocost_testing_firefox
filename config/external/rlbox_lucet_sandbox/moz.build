# -*- Mode: python; indent-tabs-mode: nil; tab-width: 40 -*-
# vim: set filetype=python:
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

if CONFIG['MOZ_WASM_SANDBOXING_ZEROCOST']:
    EXPORTS.mozilla.rlbox += [
        '/third_party/rust/rlbox_lucet_sandbox/include/lucet_sandbox.h',
        '/third_party/rust/rlbox_lucet_sandbox/include/rlbox_lucet_sandbox.hpp',
    ]

    SOURCES += [
        'rlbox_lucet_thread_locals.cpp'
    ]

elif CONFIG['MOZ_WASM_SANDBOXING_STOCK'] or CONFIG['MOZ_WASM_SANDBOXING_STOCK32'] or CONFIG['MOZ_WASM_SANDBOXING_STOCKINDIRECT'] or CONFIG['MOZ_WASM_SANDBOXING_STOCKINDIRECT32']:
    pass
elif CONFIG['MOZ_WASM_SANDBOXING_LUCET']:
    EXPORTS.mozilla.rlbox += [
        '/../rlbox_lucetstock_sandbox/include/lucet_sandbox.h',
        '/../rlbox_lucetstock_sandbox/include/rlbox_lucet_sandbox.hpp'
    ]

    SOURCES += [
        'rlbox_lucet_thread_locals.cpp'
    ]
elif CONFIG['MOZ_WASM_SANDBOXING_FULLSAVE'] or CONFIG['MOZ_WASM_SANDBOXING_REGSAVE'] or CONFIG['MOZ_WASM_SANDBOXING_FULLSAVEWINDOWS']:

    EXPORTS.mozilla.rlbox += [
        '/../zerocost_testing_sandbox/include/lucet_sandbox.h',
        '/../zerocost_testing_sandbox/include/rlbox_lucet_sandbox.hpp'
    ]

    EXPORTS += [
        '/../zerocost_testing_sandbox/include/ctx_save_trampoline.h'
    ]

    SOURCES += [
        '/../zerocost_testing_sandbox/c_src/trampoline_asm.S',
        '/../zerocost_testing_sandbox/c_src/trampoline_c.c',
        'rlbox_lucet_thread_locals.cpp'
    ]
elif CONFIG['MOZ_WASM_SANDBOXING_MPKFULLSAVE']:

    EXPORTS.mozilla.rlbox += [
        '/../rlbox_mpk_sandbox/include/rlbox_mpk_sandbox.hpp'
    ]

    EXPORTS += [
        '/../rlbox_mpk_sandbox/include/ctx_save_trampoline.h'
    ]

    SOURCES += [
        '/../rlbox_mpk_sandbox/c_src/trampoline_asm.S',
        '/../rlbox_mpk_sandbox/c_src/trampoline_c.c',
        'rlbox_mpk_thread_locals.cpp'
    ]

elif CONFIG['MOZ_WASM_SANDBOXING_MPKZEROCOST']:

    EXPORTS.mozilla.rlbox += [
        '/../rlbox_mpkzerocost_sandbox/include/rlbox_mpk_sandbox.hpp'
    ]

    SOURCES += [
        'rlbox_mpk_thread_locals.cpp'
    ]

elif CONFIG['MOZ_WASM_SANDBOXING_SEGMENTSFIZEROCOST']:

    EXPORTS.mozilla.rlbox += [
        '/../rlbox_segmentsfizerocost_sandbox/include/rlbox_segmentsfi_sandbox.hpp'
    ]

    EXPORTS += [
        '/../rlbox_segmentsfizerocost_sandbox/include/segmentsfi_sandbox_runtime.h'
    ]

    SOURCES += [
        '/../rlbox_segmentsfizerocost_sandbox/c_src/segmentsfi_sandbox_runtime.cpp',
        '/../rlbox_segmentsfizerocost_sandbox/c_src/trampoline.S',
        'rlbox_mpk_thread_locals.cpp'
    ]

else:
    error('Sandboxing transition type not set')

FINAL_LIBRARY = 'xul'